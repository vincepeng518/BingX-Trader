<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>XAUT 馬丁機器人</title>
    <meta http-equiv="refresh" content="6">
    <style>
        body {
            background: #000;
            color: #ffffff;                    /* 所有文字預設白色 */
            font-family: 'Courier New', monospace;
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }
        h1 { color: #0f0; text-align: center; margin-bottom: 30px; }
        .box {
            background: #111;
            border: 1px solid #333;
            padding: 18px;
            margin: 20px 0;
            border-radius: 8px;
        }
        button {
            background: #0f0;
            color: #000;
            border: none;
            padding: 12px 24px;
            margin: 6px;
            font-weight: bold;
            cursor: pointer;
            border-radius: 6px;
        }
        button:hover { background: #0c0; }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }
        th, td {
            border: 1px solid #444;
            padding: 10px;
            text-align: center;
            color: #fff;                       /* 強制白色 */
        }
        th { background: #001100; }
        .pnl-green { color: #00ff00; font-weight: bold; }
        .pnl-red   { color: #ff3333; font-weight: bold; }
        .highlight { color: #0f0; font-weight: bold; }
    </style>
</head>
<body>
    <h1>XAUT/USDT 強化馬丁格爾機器人</h1>

    <div class="box">
        <p>金價：<span id="price" class="highlight">載入中...</span> USDT</p>
        <p>持倉：<span id="size" class="highlight">-</span> 張（共 <span id="count">0</span> 筆）</p>
        <p>浮動盈虧：<span id="pnl" class="highlight">-</span> USDT</p>
        <p>狀態：<span id="stat">載入中...</span></p>
    </div>

    <div class="box">
        <button onclick="cmd('status')">發送 /status</button>
        <button onclick="cmd('pause')">暫停交易</button>
        <button onclick="cmd('resume')">恢復交易</button>
        <button onclick="cmd('close')">強制全平</button>
    </div>

    <div class="box">
        <h2 style="color:#0f0;margin-top:0;">最近 15 筆交易紀錄</h2>
        <table>
            <thead>
                <tr><th>時間</th><th>動作</th></tr>
            </thead>
            <tbody id="trades"></tbody>
        </table>
    </div>

    <script>
        function cmd(action) {
            fetch(`/tg/${action}`);
        }

        function update() {
            fetch('/api/data')
                .then(r => r.json())
                .then(d => {
                    document.getElementById('price').innerText = Number(d.price).toFixed(2);
                    document.getElementById('size').innerText = Number(d.long_size).toFixed(6);
                    document.getElementById('count').innerText = d.entries.length;
                    document.getElementById('stat').innerText = d.status;

                    // 盈虧專屬紅綠，其餘白色
                    const pnl = Number(d.total_pnl);
                    const pnlEl = document.getElementById('pnl');
                    pnlEl.innerText = pnl.toFixed(2);
                    if (pnl >= 0) {
                        pnlEl.className = 'pnl-green';
                        pnlEl.innerText = '+' + pnl.toFixed(2);
                    } else {
                        pnlEl.className = 'pnl-red';
                    }

                    // 交易紀錄
                    let tb = document.getElementById('trades');
                    tb.innerHTML = '';
                    (d.trades || []).slice(-15).reverse().forEach(t => {
                        let tr = document.createElement('tr');
                        tr.innerHTML = `<td>${new Date().toLocaleTimeString('zh-TW')}</td><td>${t}</td>`;
                        tb.appendChild(tr);
                    });
                })
                .catch(() => {});
        }

        setInterval(update, 6000);
        update();
    </script>
</body>
</html>